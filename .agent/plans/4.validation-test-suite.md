# Validation Suite Plan

## Goal
Create an agent-executable validation checklist saved to `.agent/validation/` that covers all built features (Modules 1 & 2). The checklist uses curl for API tests and Playwright MCP tools for E2E browser tests, with clear pass/fail criteria.

## What Gets Created

**File:** `.agent/validation/full-suite.md`

A structured checklist with 36+ API tests and 23 E2E tests covering:

### API Tests (curl-based)
| Section | Tests | Coverage |
|---------|-------|----------|
| Health & Auth | API-01 to API-04 | Health endpoint, auth required, invalid/valid tokens |
| Thread CRUD | API-05 to API-11 | Create, list, get, update, delete threads |
| Data Isolation | API-12 to API-15 | User 2 can't access User 1's threads |
| Chat/Messages | API-16 to API-19 | Empty thread, SSE streaming, message persistence, isolation |
| Documents | API-20 to API-30 | Upload .txt/.md, reject invalid types, empty files, list, delete, status transitions, isolation |
| Settings | API-31 to API-33 | Get defaults, update, API key masking |
| Error Handling | API-34 to API-36 | Nonexistent thread, empty message, no auth |

### E2E Browser Tests (Playwright MCP)
| Section | Tests | Coverage |
|---------|-------|----------|
| Auth Flow | E2E-01 to E2E-04 | Redirect to /auth, sign in, invalid creds, protected routes |
| Chat Flow | E2E-05 to E2E-09 | New thread, send message, streaming response, persistence, delete |
| Navigation | E2E-10 to E2E-11 | Chat <-> Documents page toggle |
| Documents | E2E-12 to E2E-15 | Upload zone, file upload, realtime status, delete |
| RAG Integration | E2E-16 to E2E-17 | Upload doc, ask question, verify retrieval |
| Data Isolation | E2E-18 to E2E-22 | Sign out, sign in as User 2, verify isolation, sign back |
| Error Handling | E2E-23 | Invalid file type rejection in UI |

### Structure of Each Test
```
### TEST-ID: Description
**Steps:** (curl command or Playwright MCP tool sequence)
**Acceptance Criteria:** (exact expected result for pass/fail)
```

### Cleanup Section
- Delete test threads, documents, and reset settings after run

## Implementation Steps

1. **Create directory** `.agent/validation/`
2. **Write `full-suite.md`** with all tests structured for agent execution
3. **Create test fixture files** in `.agent/validation/fixtures/`:
   - `test_document.txt` - Simple text for upload tests
   - `test_rag_document.txt` - Eiffel Tower content for RAG tests
   - `test_document.md` - Markdown file for upload tests
   - `empty.txt` - Zero-byte file for rejection test
4. **Write execution instructions** at top of suite explaining:
   - How to obtain JWT tokens (Supabase auth endpoint)
   - Variable tracking ($TOKEN1, $TOKEN2, $THREAD_ID, etc.)
   - Test ordering dependencies
   - Timeout guidance for streaming/async operations

## Key Design Decisions
- **No test framework code** - Pure checklist format executable by any agent with MCP tools
- **Self-contained** - Fixture files included, no external dependencies
- **Ordered by dependency** - Tests that create data run before tests that read it
- **Cleanup included** - Suite leaves system in clean state after run
- **Timeout guidance** - Each async operation has explicit max wait times

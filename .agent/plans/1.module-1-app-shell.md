# Module 1: App Shell + Observability

## Complexity: ⚠️ Medium
Multiple interconnected components (auth, API, UI, OpenAI integration, streaming) but achievable in sequential tasks.

---

## Overview

Build the foundation: authentication, chat interface, and OpenAI Responses API integration with LangSmith tracing. OpenAI's Responses API provides "managed RAG" - it handles threading, memory, and file_search internally.

---

## Project Structure

```
claude-code-agentic-rag-masterclass/
├── frontend/                    # React + Vite application
│   ├── src/
│   │   ├── components/
│   │   │   ├── ui/             # shadcn/ui components
│   │   │   ├── auth/           # AuthForm.tsx
│   │   │   └── chat/           # ThreadList.tsx, ChatView.tsx
│   │   ├── hooks/              # useAuth.ts
│   │   ├── lib/                # supabase.ts, api.ts
│   │   ├── pages/              # ChatPage.tsx
│   │   ├── types/
│   │   ├── App.tsx
│   │   ├── main.tsx
│   │   └── index.css
│   ├── package.json
│   ├── vite.config.ts
│   ├── tailwind.config.js
│   └── components.json
│
├── backend/
│   ├── app/
│   │   ├── main.py             # FastAPI app
│   │   ├── config.py           # Environment config
│   │   ├── dependencies.py     # Auth middleware
│   │   ├── routers/
│   │   │   ├── auth.py
│   │   │   ├── threads.py
│   │   │   └── chat.py
│   │   ├── services/
│   │   │   ├── openai_assistant.py
│   │   │   └── langsmith.py
│   │   ├── models/
│   │   │   └── schemas.py      # Pydantic models
│   │   └── db/
│   │       └── supabase.py
│   └── requirements.txt
```

---

## Task Sequence

### 1. Backend Setup
**Files:** `backend/app/main.py`, `backend/app/config.py`, `backend/requirements.txt`

Create FastAPI skeleton with health endpoint, CORS, and environment config using pydantic-settings.

**Validation:** `curl http://localhost:8000/health` returns `{"status":"ok"}`

---

### 2. Supabase Client
**Files:** `backend/app/db/supabase.py`

Create Supabase client wrapper with service role key for backend operations.

**Validation:** Can connect and query Supabase

---

### 3. Database Schema
**Location:** Supabase SQL Editor

Create tables:
- `threads` (id, user_id, openai_thread_id, title, created_at, updated_at)
- `messages` (id, thread_id, user_id, openai_message_id, role, content, created_at)

Enable RLS with policies: users can only see/modify their own data.

**Validation:** Tables exist with shield icon (RLS enabled)

---

### 4. Auth Middleware
**Files:** `backend/app/dependencies.py`, `backend/app/routers/auth.py`

Verify Supabase JWT tokens, extract user info. Create `/auth/me` endpoint.

**Validation:** `/auth/me` returns user info with valid token, 401 with invalid

---

### 5. Frontend Setup
**Files:** Vite + React + Tailwind + shadcn/ui scaffolding

Initialize frontend with proper tooling configuration.

**Validation:** `npm run dev` shows React app

---

### 6. Frontend Supabase Client
**Files:** `frontend/src/lib/supabase.ts`

Create Supabase client with anon key.

**Validation:** Can connect to Supabase

---

### 7. Auth UI
**Files:** `frontend/src/hooks/useAuth.ts`, `frontend/src/components/auth/AuthForm.tsx`

Sign in/sign up forms with Supabase Auth.

**Validation:** Can create account and sign in

---

### 8. OpenAI Assistant Service
**Files:** `backend/app/services/openai_assistant.py`

Functions to:
- Get or create assistant with file_search tool
- Create threads
- Add messages
- Stream run responses

**Validation:** Creates assistant, can create thread

---

### 9. Thread API
**Files:** `backend/app/routers/threads.py`, `backend/app/models/schemas.py`

Endpoints: list threads, create thread, delete thread.

**Validation:** CRUD operations work, RLS enforced

---

### 10. Chat API with SSE
**Files:** `backend/app/routers/chat.py`

Endpoints:
- `GET /{thread_id}/messages` - get messages
- `POST /{thread_id}/messages` - send message, stream response via SSE

**Validation:** Streaming response arrives in chunks

---

### 11. Thread List UI
**Files:** `frontend/src/components/chat/ThreadList.tsx`

Show list of threads, new chat button, select thread.

**Validation:** Threads display, can create new

---

### 12. Chat View UI
**Files:** `frontend/src/components/chat/ChatView.tsx`, `frontend/src/lib/api.ts`

Message display, input field, SSE streaming consumption.

**Validation:** Can send message, see streaming response

---

### 13. Main App Assembly
**Files:** `frontend/src/pages/ChatPage.tsx`, `frontend/src/App.tsx`

Wire together auth, thread list, chat view.

**Validation:** Full flow works when logged in

---

### 14. LangSmith Tracing
**Files:** `backend/app/services/langsmith.py`

Wrap OpenAI client with LangSmith tracing, set environment variables.

**Validation:** Traces visible in LangSmith dashboard

---

## Environment Variables

### Backend `.env`
```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
OPENAI_API_KEY=sk-your-key
OPENAI_ASSISTANT_ID=  # Created on first run
LANGSMITH_API_KEY=ls-your-key
LANGSMITH_PROJECT=rag-masterclass
CORS_ORIGINS=["http://localhost:5173"]
```

### Frontend `.env`
```
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_API_URL=http://localhost:8000
```

---

## Key Dependencies

### Backend
- fastapi, uvicorn
- supabase (Python client)
- openai (Responses API)
- langsmith (tracing)
- sse-starlette (streaming)
- pydantic, pydantic-settings

### Frontend
- react, react-dom, react-router-dom
- @supabase/supabase-js
- tailwindcss, shadcn/ui components
- lucide-react (icons)

---

## Verification

End-to-end test:
1. Start backend: `uvicorn app.main:app --reload`
2. Start frontend: `npm run dev`
3. Sign up new user
4. Create new thread
5. Send message, observe streaming response
6. Check LangSmith for trace
7. Sign out, sign in again, verify thread persists
8. Try accessing thread as different user (should fail - RLS)
